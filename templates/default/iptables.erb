# Generated by Chef for <%= node['fqdn'] %>
# Do NOT modify this file by hand.
#
<%# IPtables declares items in the following pattern:
*tablename, e.g. *filter or *mangle
default chains
custom chains
rules to go into the chain
COMMIT
next table and so on
 %>
<% unless @iptables.nil? || @iptables.empty? -%>
<% @iptables.each do |table, data| -%>
*<%= table %>
<%# Put the chains in the file, format of :Name%>
<% unless data['chains'].nil? || data['chains'].empty? -%>
<% data['chains'].each do |chain, value| -%>
:<%= chain %> <%= value %>
<% end -%>
<% end -%>
<%# Flush the chains in the file %>
<% unless data['chains'].nil? || data['chains'].empty? -%>
<% data['chains'].each do |chain, value| -%>
<% next if chain == :FORWARD -%>
-F <%= chain %>
<% end -%>
<% end -%>
<%# once all chains are down we put the rules down%>
<% unless data['rules'].nil? || data['rules'].empty? -%>
<% data['rules'].each do |rule| -%>
<%= rule %>
<% end -%>
<% end -%>
COMMIT
<% end -%>
<% end -%>
